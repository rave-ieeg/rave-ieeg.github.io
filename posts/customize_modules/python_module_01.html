<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zhengjia Wang">
<meta name="dcterms.date" content="2025-02-27">
<meta name="description" content="Try RAVE today!">

<title>Create a Python Pipeline – RAVE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-da0c5ad94b4ced3c924b2ff945cdd7a3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=GTM-MVX9KRN9"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GTM-MVX9KRN9', { 'anonymize_ip': true});
</script>
<script type="text/javascript" src="../../js/customize.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">RAVE</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/3dviewer/viewer301.html?viewer=full"> 
<span class="menu-text">Demo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blogs.html"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/orgs/rave-ieeg/discussions" target="_blank"> 
<span class="menu-text">Help &amp; Discussion</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/rave-ieeg/" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Create a Python Pipeline</h1>
                  <div>
        <div class="description">
          <p>Try RAVE today!</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Module</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-left">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Zhengjia Wang </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Dept. of Neurosurgery, University of Pennsylvania
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-left">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 27, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-fork-and-open-the-official-rave-pipeline-repository" id="toc-part-1-fork-and-open-the-official-rave-pipeline-repository" class="nav-link active" data-scroll-target="#part-1-fork-and-open-the-official-rave-pipeline-repository">Part 1: Fork and open the official RAVE pipeline repository</a>
  <ul class="collapse">
  <li><a href="#open-the-rave-pipelines-project" id="toc-open-the-rave-pipelines-project" class="nav-link" data-scroll-target="#open-the-rave-pipelines-project">1.1 Open the “rave-pipelines” project</a></li>
  <li><a href="#testdebug-rave-modules" id="toc-testdebug-rave-modules" class="nav-link" data-scroll-target="#testdebug-rave-modules">1.2 Test/Debug RAVE modules</a></li>
  </ul></li>
  <li><a href="#part-2-create-edit-run-a-python-pipeline" id="toc-part-2-create-edit-run-a-python-pipeline" class="nav-link" data-scroll-target="#part-2-create-edit-run-a-python-pipeline">Part 2: Create, edit, run a Python pipeline</a>
  <ul class="collapse">
  <li><a href="#create-a-new-python-module" id="toc-create-a-new-python-module" class="nav-link" data-scroll-target="#create-a-new-python-module">2.1 Create a new Python module</a></li>
  <li><a href="#main.rmd---the-entry-point" id="toc-main.rmd---the-entry-point" class="nav-link" data-scroll-target="#main.rmd---the-entry-point">2.2 <code>main.Rmd</code> - the entry point</a>
  <ul class="collapse">
  <li><a href="#anatomy-of-rave-markdown" id="toc-anatomy-of-rave-markdown" class="nav-link" data-scroll-target="#anatomy-of-rave-markdown">2.2.1 Anatomy of RAVE-markdown</a></li>
  <li><a href="#compile-and-run-a-rave-pipeline" id="toc-compile-and-run-a-rave-pipeline" class="nav-link" data-scroll-target="#compile-and-run-a-rave-pipeline">2.2.2 Compile and run a RAVE pipeline</a></li>
  </ul></li>
  <li><a href="#settings.yaml---user-inputs" id="toc-settings.yaml---user-inputs" class="nav-link" data-scroll-target="#settings.yaml---user-inputs">2.3 <code>settings.yaml</code> - user inputs</a>
  <ul class="collapse">
  <li><a href="#programmatically-set-pipeline-inputs" id="toc-programmatically-set-pipeline-inputs" class="nav-link" data-scroll-target="#programmatically-set-pipeline-inputs">2.3.1 Programmatically set pipeline inputs</a></li>
  </ul></li>
  <li><a href="#scopeenclosure-of-target-scripts" id="toc-scopeenclosure-of-target-scripts" class="nav-link" data-scroll-target="#scopeenclosure-of-target-scripts">2.4 Scope/enclosure of target scripts</a></li>
  <li><a href="#shared-scripts---do-not-repeat-yourself" id="toc-shared-scripts---do-not-repeat-yourself" class="nav-link" data-scroll-target="#shared-scripts---do-not-repeat-yourself">2.5 Shared scripts - Do not repeat yourself</a>
  <ul class="collapse">
  <li><a href="#py-share-python-functionsmodules-across-targets" id="toc-py-share-python-functionsmodules-across-targets" class="nav-link" data-scroll-target="#py-share-python-functionsmodules-across-targets">2.5.1 <code>py/</code> share Python functions/modules across targets</a></li>
  </ul></li>
  <li><a href="#part-3-implement-fooof-pipeline" id="toc-part-3-implement-fooof-pipeline" class="nav-link" data-scroll-target="#part-3-implement-fooof-pipeline">Part 3: Implement <code>fooof</code> pipeline</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/edit/main/posts/customize_modules/python_module_01.md" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/blob/main/posts/customize_modules/python_module_01.md" target="_blank" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<div class="alert alert-warning" role="alert">
<p>Please make sure you <a href="../../posts/installation/installation.html">install RAVE and RStudio</a> first. This tutorial needs Python to be configured for RAVE. Please make sure you run this one-time setup command if you haven’t done so <code>ravemanager::configure_python()</code>.</p>
</div>
<section id="part-1-fork-and-open-the-official-rave-pipeline-repository" class="level1">
<h1>Part 1: Fork and open the official RAVE pipeline repository</h1>
<p>It is highly recommended that a Github account is obtained for this tutorial, especially if the plan is to publish customized modules or collaborate with others. For those who wish to making their modules available to all RAVE users by default, a Github account is a must.</p>
<p>Once a Github account is obtained (otherwise jump to the next paragraph), go to https://github.com/rave-ieeg/rave-pipelines , click on <strong><i class="fa-solid fa-code-fork"></i> Fork</strong> button on the top-right of the navigation bar. Please do not change anything, simply click on <strong>Create a fork</strong> button, and Github will create a copy of the pipeline module repository under a private account. From now on everything should be operated on this “forked” repository.</p>
<p><img src="./figure-howto-fork.png" class="img-fluid"></p>
<p>Under the repository, click on <strong><i class="fa-solid fa-code"></i> Code</strong> button, choose <strong>Local</strong> &gt; <strong>Clone</strong> &gt; <strong>Https</strong>, copy the web URL, which should follow the format <code>https://github.com/&lt;your username&gt;/rave-pipelines.git</code>.</p>
<p>Open <strong>RStudio</strong>, go to navigation bar (on the top of the application), click and choose <strong>File</strong> &gt; <strong>New Project…</strong> &gt; <strong>Version Control</strong> &gt; <strong>Git</strong>, and paste the repository URL. Make sure choosing a proper parent folder. A <code>rave-pipelines</code> folder will be created as a sub-directory of the parent folder.</p>
<p><img src="./figure-new-project.png" class="img-fluid"></p>
<p>Now click on <strong>Create Project</strong> button in the wizard, <strong>RStudio</strong> will automatically download the RAVE pipeline repository and switch its working directory to the repository directory.</p>
<section id="open-the-rave-pipelines-project" class="level2">
<h2 class="anchored" data-anchor-id="open-the-rave-pipelines-project">1.1 Open the “rave-pipelines” project</h2>
<p>It is important that <strong>RStudio</strong> works at <code>rave-pipelines</code> project level. This can be verified by checking the up-right corner of the <strong>RStudio</strong> label. If the active project is not <code>rave-pipelines</code>, simply click on the project drop-down icon and choose “<strong>rave-pipelines</strong>” to activate.</p>
<p><img src="./figure-rstudio-project.png" class="img-fluid"></p>
</section>
<section id="testdebug-rave-modules" class="level2">
<h2 class="anchored" data-anchor-id="testdebug-rave-modules">1.2 Test/Debug RAVE modules</h2>
<p>Open project <code>rave-pipelines</code> in <strong>RStudio</strong>, type in R command</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ravedash<span class="sc">::</span><span class="fu">debug_modules</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A dashboard system will launch in the background, allowing interactive UI debugging.</p>
<p>RAVE provides mechanisms to separate the code logistics and UI (user-interface) components. A comprehensive analysis should execute with or without user-interface. In the following context, we refer “<strong>pipeline</strong>” to the code/script part, where the end-users can run the code offline (without UI), and “<strong>UI</strong>” to the user-interface part. A RAVE module often consists of a non-interactive pipeline (code) and an interactive UI.</p>
</section>
</section>
<section id="part-2-create-edit-run-a-python-pipeline" class="level1">
<h1>Part 2: Create, edit, run a Python pipeline</h1>
<p>In this part, we will demonstrate a real example, and create a RAVE module that applies the <a href="https://fooof-tools.github.io/fooof/"><code>fooof</code> algorithm</a>, which is written in Python, to analyze the voltage periodograms.</p>
<p>We will start with the pipeline (code) part. At the end of this part, a python module should be ready to run by RAVE end-users. The Part 3 will discuss about building UI around the pipeline.</p>
<section id="create-a-new-python-module" class="level2">
<h2 class="anchored" data-anchor-id="create-a-new-python-module">2.1 Create a new Python module</h2>
<p>Open project <code>rave-pipelines</code>, type the following R command in the console:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>raveio<span class="sc">::</span><span class="fu">module_add</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">module_id =</span> <span class="st">"fooof_module"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">module_label =</span> <span class="st">"Fooof"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"python"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A folder named with module ID <strong>fooof_module</strong> is created under the <strong>modules/</strong> folder. If we run the debug code <code>ravedash::debug_modules()</code>, an empty “Fooof” module is available at the side-bar. If we click on the module, only a built-in loading screen will be popped up, since we haven’t added anything to the module yet.</p>
<p><img src="figure-addmodule.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>In RAVE, each module has a distinct module ID (<code>fooof_module</code> in this case) and a human friendly label name (<code>Fooof</code>). Please make sure the module ID is unique and does not collide with others. A good convention follows <code>&lt;institute&gt;_&lt;lab_name&gt;_&lt;module_id&gt;</code>, such as <code>utmb_karaslab_freez</code>, or <code>upenn_ese25_fooof</code>.</p>
</blockquote>
<p><img src="figure-glimpse.png" class="img-fluid"></p>
<p>Open <strong>modules/fooof_module/</strong> directory, and we will see the pipeline files. The following list includes the most important files:</p>
<ul>
<li><code>DESCRIPTION</code> declares title, descriptions, and authorship of the module;</li>
<li><code>main.Rmd</code> RAVE-markdown file, the entry point containing the important analysis scripts of the pipeline;</li>
<li><code>settings.yaml</code> pipeline user inputs;</li>
<li><code>py/</code> A folder containing shared Python functions that can be reused by <strong>main.Rmd</strong>;</li>
<li><code>R/</code> A folder containing UI code and shared R functions that can be reused by <strong>main.Rmd</strong>.</li>
</ul>
</section>
<section id="main.rmd---the-entry-point" class="level2">
<h2 class="anchored" data-anchor-id="main.rmd---the-entry-point">2.2 <code>main.Rmd</code> - the entry point</h2>
<section id="anatomy-of-rave-markdown" class="level3">
<h3 class="anchored" data-anchor-id="anatomy-of-rave-markdown">2.2.1 Anatomy of RAVE-markdown</h3>
<p>Markdown is a type of markup language for creating formatted text using a plain-text editor. A RAVE-markdown document is a special file in markdown that allows RAVE to construct a pipeline from the code blocks.</p>
<p>A typical RAVE-markdown file (an example is <a href="https://github.com/rave-ieeg/rave-pipelines/blob/e94b9338acccd565d0fa790ad3dd423f6cf08397/modules/fooof_module/main.Rmd">available here</a>) starts with a key-value <a href="https://python-markdown.github.io/extensions/meta_data/">meta-data</a> field specifying the title and styles of the document (possibly with other optional key-values). Please change the “<strong>title</strong>” field accordingly.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"RAVE Pipeline Markdown Template"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_document</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A setup block immediately follows the meta field. This block provides tools to help the developers debug this markdown by preparing proper environments, loading the input settings to the memory, and injecting utility functions for the pipeline. Please <em>do NOT edit nor remove</em> this block.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">{r setup, include = FALSE}</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at"># This code block sets up the engine environment</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at"># Please do not remove me</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">raveio::pipeline_setup_rmd("fooof_module")</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">rpymat::ensure_rpymat()</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After setting up the document, RAVE pipeline targets kick in. In RAVE-markdown files, pipeline “target” is simply a type of code block with a set of special options, for example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>```{python calculate_correlation, use_rave <span class="op">=</span> TRUE, deps <span class="op">=</span> c(<span class="st">"input_data"</span>), export <span class="op">=</span> <span class="st">"correlation"</span>, cue <span class="op">=</span> <span class="st">"thorough"</span>}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load numpy</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> np.corrcoef(input_data[<span class="st">'x'</span>], input_data[<span class="st">'y'</span>])</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(correlation)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A target always starts with <code>```{...}</code>, three back ticks followed by a pair of curly brackets. The first argument inside should be the programming language (e.g.&nbsp;<code>python</code> in this example, or <code>r</code> for R language), followed by the block ID, and a punctuation mark <code>,</code>. The comment must be all letters and digits. No space is allowed. The target options should be placed after the first <code>,</code>. Each option is a <code>key=value</code> pair. Multiple options should be separated by <code>,</code>. Their order does not matter.</p>
<ul>
<li><code>```{{python calculate_correlation, ...</code> suggests that this block is written in Python, and its ID is <code>generate_input_data</code>.
<ul>
<li>The block ID must be unique and in “snake” format, no space nor special characters are allowed. The ID helps the compiler distinguish the code blocks and may serve as a descriptive comment of the target block. RAVE will automatically break the underscores and convert the comment to sentence case. For example, the above block ID will be interpreted as “Calculate correlation”.</li>
</ul></li>
<li><code>use_rave=TRUE</code>: (mandatory, logical <code>TRUE</code> or <code>FALSE</code>) if <code>TRUE</code>, this code block will be interpreted as a pipeline target, otherwise the block will be treated as a debugging/visualization block and will be ignored when compiling the RAVE-markdown.</li>
<li><code>export="input_data"</code>: (mandatory, string) the pipeline target is expected to generate an intermediate variable called <code>input_data</code> within the block. This variable must be created during evaluation. Notice all other local variables will be discarded at the end of evaluation.</li>
<li><code>deps=c("input_data", ...)</code>: (optional, vector of strings) a collection of previous targets whose code should execute prior to evaluating the current block. The the example, calculating <code>"correlation"</code> requires RAVE to check and run a previous target <code>input_data</code> first, and this behavior can be expected by setting <code>deps=c("input_data")</code>.</li>
<li><code>cue="thorough"</code>: controls the cache. RAVE tries to cache the values of the pipeline targets during evaluation. For the target objects that have been cached, their corresponding script might not need to be re-evaluated if all the depending values remain unchanged. For example, if the value of input <code>x</code> and <code>y</code> remain unchanged, then their correlation does not need to be re-calculated. RAVE checks and tries to reuse the cached targets with option <code>"thorough"</code>. Other choices are <code>"always"</code> (ignore cache and always run the code) and <code>"never"</code> (if cache exists, never update).</li>
</ul>
<p>At the end of the document, there are two special blocks that are <em>not</em> pipeline targets. The first block helps RAVE extract the code blocks and interpret <code>main.Rmd</code> into a low-level make file, which will be analyzed and loaded by RAVE. (Similar to compiling languages). Please <em>do NOT edit nor remove</em> this block.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">{r build, echo=FALSE, results='hide'}</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at"># Please do not edit me</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">build_pipeline(make_file = "make-fooof_module.R")</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The last block analyzes and visualizes the pipeline target dependency graph.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">{r visualize, echo=FALSE}</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at"># Fixed usage, show pipeline graph</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">try({</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  asNamespace("ravepipeline")$pipeline_dependency_graph(</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">    pipeline_path = ".", glimpse = TRUE)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">}, silent = TRUE)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure-dep-graph.png" class="img-fluid figure-img"></p>
<figcaption>In the full example, target “correlation” depends on “input_data”, hence there is a direct arrow pointing from <code>input_data</code> to <code>correlation</code>. RAVE will use the dependency graph to decide which target code to run when evaluating/updating the pipelines.</figcaption>
</figure>
</div>
</section>
<section id="compile-and-run-a-rave-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="compile-and-run-a-rave-pipeline">2.2.2 Compile and run a RAVE pipeline</h3>
<p>Please copy the following <a href="https://github.com/rave-ieeg/rave-pipelines/blob/e94b9338acccd565d0fa790ad3dd423f6cf08397/modules/fooof_module/main.Rmd">toy example RAVE-markdown script</a> to your own <code>main.Rmd</code>. This example consists of two targets:</p>
<ol type="1">
<li>randomly generate two sequences of data samples; store them into a variable <code>input_data</code></li>
<li>compute the correlation of these two samples; store them into <code>correlation</code></li>
</ol>
<p>To compile the RAVE-markdown file, click on the <code>knit</code> button right above the RStudio editor. RAVE will turn <strong>main.Rmd</strong> into an HTML website.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure-knit-button.png" class="img-fluid figure-img"></p>
<figcaption>The “knit” button. In some versions of RStudio, this buton might be replaced by a “Render” button. These two are the same: they reshape the RAVE-markdown document into low-level RAVE pipeline files</figcaption>
</figure>
</div>
<p>Once a RAVE-markdown is compiled, the pipeline can be loaded via the <code>raveio</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">&lt;-</span> raveio<span class="sc">::</span><span class="fu">pipeline</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pipeline_name =</span> <span class="st">"fooof_module"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">paths =</span> <span class="fu">file.path</span>(rstudioapi<span class="sc">::</span><span class="fu">getActiveProject</span>(), <span class="st">"modules"</span>), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">temporary =</span> <span class="cn">TRUE</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Users may use variable <code>pipeline</code> to inspect, execute, and debug the pipeline:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect runnable pipeline targets</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span>target_table</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Names           Description</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 settings_path   Check settings file</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      settings         Load settings</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ...</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    input_data   Generate input data</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7   correlation Calculate correlation</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute the pipeline and obtain the `correlation`. RAVE analyzes the</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># dependency graph and only execute the code needed to get the results</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">run</span>(<span class="st">"correlation"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target input_data</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target input_data</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target correlation</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target correlation</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ ended pipeline</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unserializing [correlation] using Python module [fooof_module]</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; array([[ 1.        , -0.00115628],</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        [-0.00115628,  1.        ]])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The results can be read via R command <code>pipeline$read</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> pipeline<span class="sc">$</span><span class="fu">read</span>(<span class="st">"correlation"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlation)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unserializing [correlation] using Python module [fooof_module]</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; array([[ 1.        , -0.00115628],</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        [-0.00115628,  1.        ]])</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to R object</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>rpymat<span class="sc">::</span><span class="fu">py_to_r</span>(correlation)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              [,1]         [,2]</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  1.000000000 -0.001156276</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -0.001156276  1.000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The intermediate target objects can also be obtained via <code>pipeline$read</code>. Since <code>input_data</code> is needed to generate <code>correlation</code>, we can query the <code>input_data</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rpymat<span class="sc">::</span><span class="fu">py_to_r</span>(pipeline<span class="sc">$</span><span class="fu">read</span>(<span class="st">"input_data"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unserializing [input_data] using Python module [fooof_module]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $x</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1]  0.295724397  0.564604875  0.148322479 -0.601025450</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [5] -1.231688320  0.806052141 -0.530310763 -1.005618898</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ...</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $y</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1]  0.419751857 -0.049027138  0.370873782 -0.447514917</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [5]  1.072258166  1.449203206  0.702124070  0.504838715</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="settings.yaml---user-inputs" class="level2">
<h2 class="anchored" data-anchor-id="settings.yaml---user-inputs">2.3 <code>settings.yaml</code> - user inputs</h2>
<p>RAVE analysis pipelines allow users to set their own inputs, such as project and subject from which the data should be loaded, frequency ranges where analyses should be applied, or t-value thresholds that select significant channels, etc. These configurable settings are stored at file <code>settings.yaml</code>, a human-readable data serialization “YAML” file.</p>
<p>During the code evaluation, RAVE will read in all the key-value pairs from <code>settings.yaml</code> and make them available to the targets in both R and Python environments. The key will be the variable name and the value will be the variable value.</p>
<p>To understand how RAVE handles the user input files, let’s <a href="https://github.com/rave-ieeg/rave-pipelines/blob/877f41017801682c9d5e38d202cc9da183c5f113/modules/fooof_module/settings.yaml">use this example</a> that contains two user inputs: <code>sample_size</code> and <code>random_generator</code>. In the previous “main.Rmd”, the number of random variables <code>"10"</code> and random number generator are hard-coded. We hope that the sample size can be controlled by users via input <code>sample_size</code>, and the generator function be controlled by <code>random_generator</code>. Here is the implementation (<a href="https://github.com/rave-ieeg/rave-pipelines/blob/877f41017801682c9d5e38d202cc9da183c5f113/modules/fooof_module/main.Rmd">the full version is available here</a>):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> Begin: pipeline code <span class="op">--&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Generate some random data</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>```{python generate_input_data, use_rave <span class="op">=</span> TRUE, deps <span class="op">=</span> c(<span class="st">"sample_size"</span>, <span class="st">"random_generator"</span>), export <span class="op">=</span> <span class="st">"input_data"</span>}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sample size as integer</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>sample_s <span class="op">=</span> <span class="bu">int</span>(sample_size)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sample_size <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Sample size should be positive"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># get random number generator</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> random_generator <span class="op">==</span> <span class="st">"randn"</span>:</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  generator <span class="op">=</span> np.random.randn</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> random_generator <span class="op">==</span> <span class="st">"randint"</span>:</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  generator <span class="op">=</span> np.random.randint</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> random_generator <span class="op">==</span> <span class="st">"rand"</span>:</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  generator <span class="op">=</span> np.random.rand</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Unknown random number generator </span><span class="sc">{</span> generator_name <span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>input_data <span class="op">=</span> {</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">'x'</span> : generator(sample_size),</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">'y'</span> : generator(sample_size)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>Calculate the correlation coefficients</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>```{python calculate_correlation, use_rave <span class="op">=</span> TRUE, deps <span class="op">=</span> <span class="st">"input_data"</span>, export <span class="op">=</span> <span class="st">"correlation"</span>}</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> np.corrcoef(input_data[<span class="st">'x'</span>], input_data[<span class="st">'y'</span>])</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(correlation)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> End: pipeline code <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pipeline target <code>input_data</code> now depends on <code>sample_size</code> and <code>random_generator</code>. When evaluating <code>input_data</code>, these two inputs will be made available. Here is the dependency graph:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure-dep-graph2.png" class="img-fluid figure-img"></p>
<figcaption>To obtain the <code>correlation</code>, RAVE first obtain the settings.yaml file, read in the content and store the values as <code>settings</code> variable. Then the inputs will be dispatched as separate targets before being being fed into <code>input_data</code>. The results of <code>input_data</code> are then used to calculate correlation</figcaption>
</figure>
</div>
<p>If we compile and execute the pipeline, we see:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">run</span>(<span class="st">"correlation"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target settings_path                        &lt;- get settings path</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target settings_path [0 seconds, 43 bytes]</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target settings                             &lt;- read in settings.yaml</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target settings [0.001 seconds, 118 bytes]</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target sample_size                          &lt;- dispatch sample_size</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target random_generator                     &lt;- dispatch random_generator in parallel</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target sample_size [0 seconds, 49 bytes]</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target random_generator [0 seconds, 58 bytes]</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Serializing [input_data] using Python module [fooof_module]</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; shared/user/input_data                                   &lt;- try to find cache</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target input_data                           &lt;- no cache found, evaluating input_data</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target input_data [0.686 seconds, 115 bytes]</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Serializing [correlation] using Python module [fooof_module]</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; shared/user/correlation                                  &lt;- try to find cache</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ dispatched target correlation                          &lt;- no cache found, calculating correlation</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● completed target correlation [0 seconds, 115 bytes]</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ▶ ended pipeline [0.886 seconds]</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unserializing [correlation] using Python module [fooof_module]</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; array([[ 1.        , -0.04835359],                       &lt;- print final results</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        [-0.04835359,  1.        ]])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="programmatically-set-pipeline-inputs" class="level3">
<h3 class="anchored" data-anchor-id="programmatically-set-pipeline-inputs">2.3.1 Programmatically set pipeline inputs</h3>
<p><small> We will discuss advanced usages in the future. This section only covers a basic usage. </small></p>
<p>Pipeline settings can be read/written programmatically in R:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">&lt;-</span> raveio<span class="sc">::</span><span class="fu">pipeline</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pipeline_name =</span> <span class="st">"fooof_module"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">paths =</span> <span class="fu">file.path</span>(rstudioapi<span class="sc">::</span><span class="fu">getActiveProject</span>(), <span class="st">"modules"</span>), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">temporary =</span> <span class="cn">TRUE</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get settings</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">get_settings</span>()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $random_generator</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "randn"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $sample_size</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set input(s)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">set_settings</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="dv">200</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># get a specific setting</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">get_settings</span>(<span class="st">"sample_size"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 200</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="scopeenclosure-of-target-scripts" class="level2">
<h2 class="anchored" data-anchor-id="scopeenclosure-of-target-scripts">2.4 Scope/enclosure of target scripts</h2>
<p>A RAVE pipeline target consists of inputs, an output, and script. To make an analysis pipeline <strong>reproducible</strong>, there are two rules:</p>
<ul>
<li>For any target “A”, the inputs should be sufficient to generate its outputs</li>
<li>For any other target “B”, the only reliable object from “A” is its output (or “export”). All the intermediate/temporary variables will be discarded once the life-cycle of “A” ends.</li>
</ul>
<p>To understand the scope/enclosure of the RAVE pipeline targets, let’s take a look at a real-world example. Imagine drinking a bottle of water. We know that the water comes from some reservoir, and it was cleaned by some factory. However, the chemicals used by water cleaning facilities are unavailable to most ordinary people. If we abstract this example into a RAVE target, then the components are:</p>
<ul>
<li>Inputs: water from reservoir</li>
<li>Output: a bottle of clean water</li>
<li>Script: water cleaning factory
<ul>
<li>Temporary local variables: chemicals used to clean the water</li>
</ul></li>
</ul>
<p>For us who only care about drinking water, the output “a bottle of clean water” is enough, and chemicals used to clean the water is inaccessible.</p>
<p>Now let’s make such list for the pipeline targets in Section 2.3, the components of target <code>input_data</code> are:</p>
<ul>
<li>Inputs: <code>sample_size</code>, <code>random_generator</code> (read-only)</li>
<li>Output: <code>input_data</code></li>
<li>Script: code to generate <code>input_data</code>
<ul>
<li>Temporary local variables: <code>np</code>, <code>sample_size</code>, <code>generator</code></li>
</ul></li>
</ul>
<p>For all other targets (e.g.&nbsp;target <code>correlation</code>), only the <code>input_data</code> is made available, all the intermediate variables, including any changes made to these variables (e.g.&nbsp;<code>sample_size</code>) will be hidden/reverted.</p>
<p>One might argue that shared functions/modules such as <code>numpy</code> are read-only. They should be available to all targets. It would be stupid to import the same module in every target block. RAVE has a solution to this problem. We will discuss about reusing scripts to avoid “repeating ourselves” in the following section.</p>
</section>
<section id="shared-scripts---do-not-repeat-yourself" class="level2">
<h2 class="anchored" data-anchor-id="shared-scripts---do-not-repeat-yourself">2.5 Shared scripts - Do not repeat yourself</h2>
<p>In Section 2.3, both targets share the same line:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This could be annoying: do we need to repeat ourselves every time? Luckily RAVE offers a mechanism to avoid repeating ourselves for both R and Python scripts. We mainly focus on the Python part in this tutorial.</p>
<section id="py-share-python-functionsmodules-across-targets" class="level3">
<h3 class="anchored" data-anchor-id="py-share-python-functionsmodules-across-targets">2.5.1 <code>py/</code> share Python functions/modules across targets</h3>
<p>Open <code>modules/fooof_module/py</code>, we will see the following files:</p>
<ul>
<li><code>fooof_module/</code> a customized python module folder to include shared functions</li>
<li><code>knitr-common.py</code> entry-point; the script will be evaluated at the beginning of each pipeline target block.</li>
<li><code>rave-py-submodule.yaml</code> python requirement, which helps RAVE install 3rd-party “pip” or “conda” packages.</li>
</ul>
<p>Let’s implement a very simple logging feature using the Python <code>loguru</code> package. Notice this is not the most efficient implementation because we want to demonstrate the full functionality.</p>
<p>Step 1: Install <code>loguru</code> package for development use (one-time setup)</p>
<p>Run R command</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rpymat<span class="sc">::</span><span class="fu">add_packages</span>(<span class="st">"loguru"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Step 2: add <code>loguru</code> to <code>rave-py-submodule.yaml</code> so the RAVE will automatically install the package when users download the module.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> fooof_module</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> numpy</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">conda</span><span class="kw">:</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> loguru</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Step 3: create a <code>logger.py</code> at <code>modules/fooof_module/py/fooof_module/</code>, copy-paste the following script. Again, we don’t have to do this in the actual development, the goal is to demonstrate how a custom function can be shared across the targets.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> loguru <span class="im">import</span> logger</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_info(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Step 4: Create shared initialization script. Open <code>modules/fooof_module/py/knitr-common.py</code>, append these lines. For each Python target, the module <code>numpy</code> will be available as <code>np</code>, and custom function <code>log_info</code> will be available too.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fooof_module.logger <span class="im">import</span> log_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we take a glimpse of the <a href="https://github.com/rave-ieeg/rave-pipelines/blob/bfaaf4219d7ab1e607247b68842c1287d825d3e1/modules/fooof_module/py/fooof_module/rave_pipeline_adapters/pipeline_target_correlation.py">compiled target file</a>, we will see that these two lines are added on top.</p>
<p>Step 5: Go to <code>main.Rmd</code>, remove the <code>numpy</code> import line. Now we can use <code>np</code> and <code>log_info</code> without explicitly importing these two variables in every block. See <a href="https://github.com/rave-ieeg/rave-pipelines/blob/bfaaf4219d7ab1e607247b68842c1287d825d3e1/modules/fooof_module/main.Rmd">this final result</a></p>
<p>Step 6: Compile (knit) <code>main.Rmd</code></p>
<p>We can test-run the pipeline:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">&lt;-</span> raveio<span class="sc">::</span><span class="fu">pipeline</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pipeline_name =</span> <span class="st">"fooof_module"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">paths =</span> <span class="fu">file.path</span>(rstudioapi<span class="sc">::</span><span class="fu">getActiveProject</span>(), <span class="st">"modules"</span>), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">temporary =</span> <span class="cn">TRUE</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span><span class="fu">run</span>(<span class="st">"correlation"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ... (output omitted)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2025-02-28 17:36:03.792 | INFO     | fooof_module.logger:log_info:4 - Generating sample data with function np.random.randn and sample size 200</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ... (output omitted)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2025-02-28 17:36:03.803 | INFO     | fooof_module.logger:log_info:4 - Calculating correlation: </span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [[ 1.         -0.00115628]</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [-0.00115628  1.        ]]</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ... (output omitted)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From the output we can see that the <code>log_info</code> is working properly.</p>
<p>The full git change log is <a href="https://github.com/rave-ieeg/rave-pipelines/commit/bfaaf4219d7ab1e607247b68842c1287d825d3e1">here</a>:</p>
<ul>
<li><a href="https://github.com/rave-ieeg/rave-pipelines/blob/bfaaf4219d7ab1e607247b68842c1287d825d3e1/modules/fooof_module/py/rave-py-submodule.yaml">modules/fooof_module/py/rave-py-submodule.yaml</a></li>
<li><a href="https://github.com/rave-ieeg/rave-pipelines/blob/bfaaf4219d7ab1e607247b68842c1287d825d3e1/modules/fooof_module/py/knitr-common.py">modules/fooof_module/py/knitr-common.py</a></li>
<li><a href="https://github.com/rave-ieeg/rave-pipelines/blob/bfaaf4219d7ab1e607247b68842c1287d825d3e1/modules/fooof_module/py/fooof_module/logger.py">modules/fooof_module/py/fooof_module/logger.py</a></li>
</ul>
</section>
</section>
<section id="part-3-implement-fooof-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="part-3-implement-fooof-pipeline">Part 3: Implement <code>fooof</code> pipeline</h2>
<p>(TBD)</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rave\.wiki");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Credit <a href="https://dipterix.org" target="_blank">Zhengjia Wang</a> for creating the website.</p>
</div>   
    <div class="nav-footer-center">
<p><i class="fa-regular fa-copyright" aria-label="copyright"></i> Copyright 2024, <a href="https://beauchamplab.med.upenn.edu" target="_blank">BeauchampLab</a>.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/edit/main/posts/customize_modules/python_module_01.md" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/blob/main/posts/customize_modules/python_module_01.md" target="_blank" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/rave-ieeg/rave-ieeg.github.io/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><a href="https://rave.wiki/posts/editor-notes/how-to-edit-this-website.html" target="_blank">Guide to edit this website</a></p>
</div>
  </div>
</footer>




</body></html>